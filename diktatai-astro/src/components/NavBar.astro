---
import { getTranslation, getLocalePath, appUrls, type Locale } from '../i18n/utils';
import Logo from './Logo.astro';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = getTranslation(locale);

const howItWorksPath = getLocalePath('howItWorks', locale);
const pricingPath = getLocalePath('pricing', locale);
const homePath = getLocalePath('index', locale);
---

<div class="navbar bg-base-100 shadow-lg">
  <div class="container mx-auto flex justify-between items-center">
    <div class="navbar-start">
      <a href={homePath || '/'} class="btn btn-ghost normal-case text-xl font-display">
        <Logo />
      </a>
    </div>
    <!-- Mobile menu button -->
    <div class="navbar-end lg:hidden">
      <button id="mobile-menu-btn" class="btn btn-ghost" aria-label="Menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>
    </div>
    <!-- Desktop menu -->
    <div class="navbar-end hidden lg:flex">
      <ul class="menu menu-horizontal px-1">
        <li>
          <a href={howItWorksPath || '#'} class="btn btn-ghost font-display">
            {t('nav.howitworks')}
          </a>
        </li>
        <li>
          <a href={pricingPath || '#'} class="btn btn-ghost font-display">
            {t('nav.pricing')}
          </a>
        </li>
        <li>
          <a href={appUrls.login} class="btn btn-ghost font-display">
            {t('nav.login')}
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Mobile menu (overlay) -->
<div id="mobile-menu" class="fixed inset-0 z-50 lg:hidden hidden">
  <div
    id="mobile-menu-backdrop"
    class="fixed inset-0 bg-black opacity-50"
  ></div>
  <div class="fixed right-0 top-0 w-64 h-full bg-base-100 shadow-xl p-4">
    <div class="flex justify-end mb-4">
      <button id="mobile-menu-close" class="btn btn-ghost" aria-label="Close menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
    <ul class="menu">
      <li>
        <a href={howItWorksPath || '#'} class="btn btn-ghost font-display">
          {t('nav.howitworks')}
        </a>
      </li>
      <li>
        <a href={pricingPath || '#'} class="btn btn-ghost font-display">
          {t('nav.pricing')}
        </a>
      </li>
      <li>
        <a href={appUrls.login} class="btn btn-ghost font-display">
          {t('nav.login')}
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const menuClose = document.getElementById('mobile-menu-close');
  const menu = document.getElementById('mobile-menu');
  const backdrop = document.getElementById('mobile-menu-backdrop');

  function openMenu() {
    menu?.classList.remove('hidden');
  }

  function closeMenu() {
    menu?.classList.add('hidden');
  }

  menuBtn?.addEventListener('click', openMenu);
  menuClose?.addEventListener('click', closeMenu);
  backdrop?.addEventListener('click', closeMenu);

  // Close on link click
  menu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', closeMenu);
  });
</script>
